# SHE Rewards Program

### Spin Wheel and get the result

`GET /participant/rewards/wheelspin`

***Backend Business Logic***
* Check if its still possible to win for the given participant for the actual month
* Subtract 1 spin
* Do the draw logic
* If win, mark the spin as winner
* Retrieve a URL from the list of URL's and mark as used

**Response**:

* HTTP 404 Not Found (No spin available)
* HTTP 401 Unauthorized
* HTTP 200 Ok : `{ ParticipantRewardsSpin, sheRewardsPrizesUrls }`

```ts
type ParticipantRewardsSpin = {
  usedAt: Iso8601String,
  result: boolean
}

type sheRewardsPrizesUrls = {
  url: string,
  usedAt: Iso8601String
}
```

## SHE Rewards Program Endpoints

### Add Spins

`POST /participant/rewards/spins`

**Request**:

* JSON Body - `Spin`

```ts
type Spin = {  
  sheRewardsActivityId: string,
  sheAmbassador: string | null
  usedAt: Iso8601String | null,
  result: boolean | null,
  createdAt: Iso8601String | null
// ^ defaults to current time of request
}
```

**Response**:

* HTTP 405 Method Not Allowed (Reached the limit for the month)
* HTTP 201 Created

### Substract Spins

`PUT /participant/rewards/spins`

**Request**:

* JSON Body - `Spin`

```ts
type Spin = {  
  usedAt: Iso8601String | null
// ^ defaults to current time of request
}
```

**Response**:

* HTTP 400 Bad Request (No spin available)
* HTTP 200 Ok 

### Get Activity

`GET /participant/rewards/activity/{activityId}`

**Response**:

* HTTP 404 Not Found (Activity Not Found)
* HTTP 401 Unauthorized
* HTTP 200 Ok : `{ participantsRewardsActivity, SheRewardsActivity }`

```ts
type ParticipantsRewardsActivity = {
  participantId: string,
  patientId: string,
  sheRewardsActivityId: string,
  path: URL,
  completedAt: Iso8601String | null,
  clickedOn: "Dashboard" | "Rewards",
  createdAt: Iso8601String
}

type SheRewardsActivity = {
  name: string,
  tooltip: string,
  type: string,
  createdAt: Iso8601String
}
```

### Complete Activity

`PUT /participant/rewards/activity/{activityId}`

**Request**:

* JSON Body - `ParticipantsRewardsActivity`

```ts
type ParticipantsRewardsActivity = {
  sheRewardsActivityId: string,
  completedAt: Iso8601String | null,
// ^ defaults to current time of request
  clickedOn: "Dashboard" | "Rewards"
}
```

**Response**:

* HTTP 404 Not Found (Activity Not Found)
* HTTP 200 Ok



## SHE Rewards Program Collections

### SheRewardsActivities Collection

* Path - `/she-rewards-activities`
* Key  - autogenerated by Firestore 
* Data - `SheRewardsActivity`
  
### SheRewardsActivity 

* name - string
* tooltip - string
* type - Literal String - "Video" | "Pdf" | "Date" | "Social"
* createdAt - Timestamp

```json
{
  "sheRewardsActivities": {
    "Key": {
      "name": "Sexual Health Survey",
      "tooltip": "If you completed and submitted the sexual health survey via the link provided to you by your PrEP provider, you have earned one spin this month!",
      "type": "Pdf",
      "createdAt": "September 13, 2022 at 2:43:14 PM UTC-3"
    }
  }
}
``` 
### ParticipantRewardsActivities Collection

* Path - `/participant-rewards-activities`
* Key  - autogenerated by Firestore 
* Data - `ParticipantRewardsActivity`

### ParticipantRewardsActivity 

* participantId
* patientId
* sheRewardsActivityId
* path - string
* completedAt - Timestamp
* clickedOn - Literal String - "Dashboard" | "Rewards"
* createdAt - Timestamp

```json
{
  "participantRewardsActivity": {
    "Key": {
      "participantId": "ZXC123QWE123",
      "patientId": "ASD123QWE123",
      "sheRewardsActivityId": "QWE123QWE123",
      "path": "https://url.com/file.pdf",
      "completedAt": "September 20, 2022 at 10:03:02 AM UTC-3",
      "clickedOn": "Dashboard",
      "createdAt": "September 13, 2022 at 2:43:14 PM UTC-3"
    }  
  }
}
```

### ParticipantRewardsSpins Collection

* Path - `/participant-rewards-spins`
* Key  - autogenerated by Firestore 
* Data - `participantRewardsSpin`

### ParticipantRewardsSpin 

* participantId
* patientId
* sheRewardsActivityId
* sheAmbassador - email
* usedAt - Timestamp
* result - boolean
* createdAt - Timestamp

```json
{
  "participantRewardsSpins": {
    "Key": {
      "participantId": "ZXC123QWE123",
      "patientId": "ASD123QWE123",
      "sheRewardsActivityId": "QWE123QWE123",
      "sheAmbassador": "thaw@bocodigital.com"
      "usedAt": "timestamp",
      "result": false,
      "createdAt": "timestamp"
    }
  }
}
```

### SheRewardsPrizesUrls Collection

* Path - `/she-rewards-prizes-urls`
* Key  - autogenerated by Firestore 
* Data - `sheRewardsPrizesUrl`

### SheRewardsPrizesUrl

* url
* participantId
* patientId
* usedAt - Timestamp
* createdAt - Timestamp

```json
{
  "sheRewardsPrizesUrls": {
    "Key": {
      "url": "https://prizeurl.com/XYZ",
      "participantId": "ZXC123QWE123",
      "patientId": "ASD123QWE123",
      "usedAt": "September 25, 2022 at 2:43:14 PM UTC-3",
      "createdAt": "September 13, 2022 at 2:43:14 PM UTC-3"
    }
  }
}
```
